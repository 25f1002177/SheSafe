{% extends "base.html" %}

{% block title %}Dashboard - SheSafe{% endblock %}

{% block content %}
<div
    class="relative flex min-h-screen w-full flex-col overflow-x-hidden pb-32 max-w-[430px] mx-auto bg-white dark:bg-background-dark">
    <!-- Header -->
    <div
        class="flex items-center px-5 pt-10 pb-4 justify-between sticky top-0 bg-white/80 dark:bg-background-dark/80 backdrop-blur-md z-40 border-b border-slate-50 dark:border-slate-800">
        <h1 class="text-navy-trust dark:text-white text-2xl font-black tracking-tight">Activity</h1>
        <div class="flex items-center gap-3">
            <a href="{{ url_for('main.logout') }}"
                class="flex size-10 items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500">
                <span class="material-symbols-outlined text-xl">logout</span>
            </a>
        </div>
    </div>

    <!-- User Profile Hero (Simple) -->
    <div class="px-5 pt-8 mb-8">
        <div
            class="flex items-center gap-4 bg-navy-trust dark:bg-slate-900 rounded-[32px] p-6 shadow-xl shadow-navy-trust/10">
            <div class="size-16 rounded-full bg-primary/20 flex items-center justify-center border-4 border-primary/30">
                <span class="material-symbols-outlined text-primary text-3xl">face_6</span>
            </div>
            <div>
                <h2 class="text-white text-lg font-bold">{{ user.name }}</h2>
                <p class="text-primary/70 text-xs font-bold uppercase tracking-widest mt-0.5">Premium Member</p>
                <div class="flex items-center gap-1.5 mt-2">
                    <span class="material-symbols-outlined text-primary text-[10px] fill-1">verified</span>
                    <span class="text-[10px] text-white/50 font-medium">Safe Traveler Verified</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Tabs -->
    <div class="px-5">
        <div class="flex gap-6 border-b border-slate-50 dark:border-slate-800 mb-6">
            <button onclick="switchMode('history')" id="tab-history"
                class="pb-3 text-sm font-bold border-b-2 border-brand-pink text-navy-trust dark:text-white transition-all">Recent
                Visits</button>
            <button onclick="switchMode('profile')" id="tab-profile"
                class="pb-3 text-sm font-bold border-b-2 border-transparent text-slate-400 dark:text-slate-500 transition-all">Profile
                Details</button>
        </div>

        <!-- History Content -->
        <div id="content-history" class="space-y-4 animate-in fade-in duration-300">
            {% for booking in user.bookings | sort(attribute='visit_date', reverse=True) %}
            <div
                class="bg-white dark:bg-slate-900 rounded-3xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm relative overflow-hidden group">
                <!-- Status Badge -->
                <div class="absolute top-5 right-5">
                    {% if booking.status == 'upcoming' %}
                    <span
                        class="bg-blue-50 dark:bg-blue-900/30 text-blue-500 text-[9px] font-black px-2.5 py-1 rounded-full uppercase tracking-wider">Upcoming</span>
                    {% elif booking.status == 'completed' %}
                    <span
                        class="bg-primary/10 dark:bg-primary/20 text-primary text-[9px] font-black px-2.5 py-1 rounded-full uppercase tracking-wider">Completed</span>
                    {% else %}
                    <span
                        class="bg-slate-50 dark:bg-slate-800 text-slate-400 text-[9px] font-black px-2.5 py-1 rounded-full uppercase tracking-wider">{{
                        booking.status }}</span>
                    {% endif %}
                </div>

                <div class="flex items-start gap-4 mb-4">
                    <div
                        class="size-12 rounded-2xl bg-slate-50 dark:bg-slate-800 flex items-center justify-center text-navy-trust dark:text-white shrink-0">
                        <span class="material-symbols-outlined text-2xl">apartment</span>
                    </div>
                    <div class="pr-12">
                        <h4 class="text-navy-trust dark:text-white font-bold text-base leading-tight">{{
                            booking.vendor.business_name }}</h4>
                        <p class="text-slate-400 text-xs mt-1">{{ booking.visit_date.strftime('%b %d, %Y â€¢ %H:%M') }}
                        </p>
                    </div>
                </div>

                <div class="flex items-center justify-between pt-4 border-t border-slate-50 dark:border-slate-800">
                    <div class="flex flex-col">
                        <span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Reference</span>
                        <span class="text-xs font-black text-navy-trust dark:text-white">#SAFE-{{ booking.id }}</span>
                    </div>
                    <div class="flex gap-2">
                        {% if booking.status == 'completed' and not booking.feedback %}
                        <a href="{{ url_for('main.submit_feedback', booking_id=booking.id) }}"
                            class="bg-brand-pink text-white text-[10px] font-bold px-4 py-2 rounded-xl shadow-lg shadow-brand-pink/20 active:scale-95 transition-all">
                            Rate & Review
                        </a>
                        {% elif booking.status == 'upcoming' %}
                        <button
                            class="bg-navy-trust text-white text-[10px] font-bold px-4 py-2 rounded-xl shadow-lg shadow-navy-trust/20 active:scale-95 transition-all">
                            Get Help
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% else %}
            <div
                class="text-center py-20 bg-slate-50/50 dark:bg-slate-900/50 rounded-[32px] border-2 border-dashed border-slate-100 dark:border-slate-800">
                <div
                    class="size-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="material-symbols-outlined text-slate-300 text-3xl">history_toggle_off</span>
                </div>
                <h4 class="text-navy-trust dark:text-white font-bold">No visits recorded</h4>
                <p class="text-slate-400 text-xs mt-2 px-10">Your safe journeys will appear here once you start using
                    SheSafe spaces.</p>
                <a href="{{ url_for('main.index') }}"
                    class="inline-block mt-6 text-brand-pink text-xs font-bold uppercase tracking-widest">Find a space
                    now</a>
            </div>
            {% endfor %}
        </div>

        <!-- Profile Content -->
        <div id="content-profile" class="hidden space-y-6 animate-in fade-in duration-300">
            <div
                class="bg-white dark:bg-slate-900 rounded-3xl p-6 border border-slate-100 dark:border-slate-800 shadow-sm">
                <div class="space-y-6">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2">Full
                            Name</label>
                        <p
                            class="text-sm font-bold text-navy-trust dark:text-white bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl">
                            {{ user.name }}</p>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2">Email
                            Address</label>
                        <p
                            class="text-sm font-bold text-navy-trust dark:text-white bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl">
                            {{ user.email }}</p>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2">Aadhar
                            / ID Status</label>
                        <div
                            class="flex items-center justify-between bg-primary/5 p-4 rounded-2xl border border-primary/10">
                            <span class="text-sm font-bold text-primary">Identity Verified</span>
                            <span class="material-symbols-outlined text-primary fill-1">verified_user</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div
                    class="bg-white dark:bg-slate-900 rounded-[32px] p-5 border border-slate-100 dark:border-slate-800 text-center shadow-sm">
                    <span class="text-2xl font-black text-navy-trust dark:text-white">{{ user.bookings|length }}</span>
                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1">Total Visits</p>
                </div>
                <div
                    class="bg-white dark:bg-slate-900 rounded-[32px] p-5 border border-slate-100 dark:border-slate-800 text-center shadow-sm">
                    <span class="text-2xl font-black text-brand-pink">4.9</span>
                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1">Safety Score</p>
                </div>
            </div>

            <button
                class="w-full bg-red-50 text-red-500 py-5 rounded-3xl font-bold text-sm flex items-center justify-center gap-2 active:bg-red-100 transition-all mt-8">
                <span class="material-symbols-outlined text-xl">delete</span>
                Request Account Deletion
            </button>
        </div>
    </div>
</div>

<script>
    function switchMode(mode) {
        const histTab = document.getElementById('tab-history');
        const profTab = document.getElementById('tab-profile');
        const histCont = document.getElementById('content-history');
        const profCont = document.getElementById('content-profile');

        if (mode === 'history') {
            histTab.classList.add('border-brand-pink', 'text-navy-trust', 'dark:text-white');
            histTab.classList.remove('border-transparent', 'text-slate-400', 'dark:text-slate-500');
            profTab.classList.remove('border-brand-pink', 'text-navy-trust', 'dark:text-white');
            profTab.classList.add('border-transparent', 'text-slate-400', 'dark:text-slate-500');
            histCont.classList.remove('hidden');
            profCont.classList.add('hidden');
        } else {
            profTab.classList.add('border-brand-pink', 'text-navy-trust', 'dark:text-white');
            profTab.classList.remove('border-transparent', 'text-slate-400', 'dark:text-slate-500');
            histTab.classList.remove('border-brand-pink', 'text-navy-trust', 'dark:text-white');
            histTab.classList.add('border-transparent', 'text-slate-400', 'dark:text-slate-500');
            profCont.classList.remove('hidden');
            histCont.classList.add('hidden');
        }
    }

    window.addEventListener('load', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const tab = urlParams.get('tab');
        if (tab) {
            switchMode(tab);
        }
    });
</script>
{% endblock %}